\section{Full information model}\label{sec:fullinfo}
Consider an economy consisting on financial institutions that hold obligations between them.  This economy is represented using a network, where each institution is represented by a node, and the corresponding obligations are represented by arcs.  Denote by $\cN=\{1,\ldots,N\}$ the set of financial institutions, and $\cA=\{e_{ij}:i,j\in\cN\}$ the set of financial obligations.  Each financial institution $i$ is concerned about their profit maximization,  by deciding an optimal level of a liquidity index \jd{A/L?, explain this}, denoted by $r_i$.

This economy faces an liquidity shock that propagates through the network, and it is modeled as a random variable $\epsilon_0\sim{\rm U}(0,b)$.  By simplicity, let's assume that this shock affects initially institution $i$ with probability $q_i$, or it affect any other institution in the network, but it propagates by a fraction $p$ of the shock to its neighbors.  Thus, the corresponding shock that institution $i$ faces, comes either from the idiosyncratic shock, or through its neighbors (or any simple-connected neighbor in the network).  Let $A$ be the adjencency matrix, i.e. $A_{i,j} = \begin{cases} 1 & (i,j)\in\cA\\ 0 &o.w.\end{cases}$, and let $\epsilon=(\epsilon_1,\ldots,\epsilon_N)$ be the vector of expected shocks.  The shock vector satisfies

\begin{equation}\label{eps}
\epsilon = S(p)\epsilon_0,\quad S(p)=\left(I +\sum_{k=1}^{N-1}p^k\tilde{A}^k\right)q,\quad \tilde{A}_1=A,\,\tilde{A}_k = A\tilde{A}_{k-1}-{\rm diag}(A\tilde{A}_{k-1})
\end{equation}

Each institution $i$ is assume to be under \emph{distress} if its liquidity index after the effect of the shock is below a given threshold $\lambda$.  Thus,
\begin{equation}\label{distress}
{\rm institution}\,i\,{\rm is\,under\,distress} \iff r_i(1-\epsilon_i) < \lambda.
\end{equation}

Additionally, we consider a benevolent financial regulator or central planner, whose goal is to maintain the stability of the financial system, while encouraging the utility maximization of each of the participants.  The only mechanism that this regulator dispose is a minimum capital requirement, that firstly, we assume that is institution-contingent.  By denoting this liquidity requirement policy by $x=(x_1,\ldots,x_N)$, and giving the propagation factor $p$, the institution $i$ solves the following optimization problem
\begin{equation}\label{imax}
r^*_i(x_i;p)\in\argmax_{r\in R_i} \lset \Ex_p\{ \pi_i(r(1-\epsilon_i))\} \mset r\geq x_i,\,\Ex_p\{\pi_i(r(1-\epsilon_i))\}\geq 0\rset,
\end{equation}
where $\epsilon_i$ comes from Equation~(\ref{eps}).  Let's consider a linear utility function, uniform for every agent, defined by
\[\pi(\tau)=\begin{cases} a_0-a_1\tau&\tau\geq \lambda\\ 0 & {\rm o.w.}\end{cases}.\]
Therefore, the expectation is given by
\begin{eqnarray*}
\Ex\{ \pi_i(r(1-\epsilon_i))\}&=&\begin{cases}
0&1-\frac{\lambda}{r}\leq 0\\
a_0-a_1r(1-\Ex\{\epsilon_i\})&\frac{1}{S_i(p)\cdot b}\left(1-\frac{\lambda}{r}\right)\geq 1\\
\frac{1}{(S_i(p)\cdot b)^2}\left(1-\frac{\lambda}{r}\right)^2\left(a_0-a_1r\left(1-\frac{1}{2}\left(1-\frac{\lambda}{r}\right)\right)\right)\,&{\rm o.w.}
\end{cases}
\end{eqnarray*}
Note that this function is continuous.  Define 
\[\lambda_i(p)=\frac{1}{1-S_i(p)\cdot b}\,\lambda, \quad \bar{\epsilon}=\Ex\{\epsilon_0\}=\frac{b}{2},\quad r^u=\frac{a^0}{a^1}\frac{1}{1-\bar{\epsilon}}.\]

The optimal value for $x_i\geq 0$ is given by
\begin{equation}\label{optri}
r_i^*(x_i)\in\argmax_{r\in R_i} \lset \Ex_p\{ \pi_i(r(1-\epsilon_i))\}\mset r\geq x_i, \Ex_p\{ \pi_i(r(1-\epsilon_i))\}\geq 0\rset = \begin{cases}
\emptyset & x_i\geq r^u\\
\lambda_i& 0\leq x_i<\lambda_i\\
x_i& \mbox{o.w}\end{cases}
\end{equation}
The function $\Ex_p\{ \pi_i(r(1-\epsilon_i))\}$ is depicted in Figure~(\ref{figExUt}).  From here it is easy to see that the optimum of the optimization problem depends on the values of $x_i$.

\begin{figure}[htbp] 
%\begin{minipage}{1.0\textwidth}
\centering
\begin{minipage}[t]{0.49\textwidth}
%\begin{figure}[htbp] 
   \centering
   \includegraphics[width=0.95\textwidth]{Figures/ExpectedUt} 
   \caption{Expected utility}
   \label{figExUt}
%\end{figure}
\end{minipage}
\hfill
\begin{minipage}[t]{0.49\textwidth}
%\begin{figure}[htbp] %  figure placement: here, top, bottom, or page
   \centering
   \includegraphics[width=0.95\textwidth]{Figures/OptExpUt} 
   \caption{Optimal Expected utility}
   \label{figOpExUt}
%\end{figure}
\end{minipage}
%\end{minipage}
\end{figure}

Finally, the optimal expected utility is given by
\begin{equation}\label{eqEPOpt}
\Ex_p\{\pi_i(r_i^*(x_i)(1-\epsilon_i))\}=\begin{cases}
a_0-a_1x_i(1-S_i(p)\bar\epsilon)&\lambda_i\leq x_i\leq r^u\\
a_0-a_1\lambda_i(1-S_i(p)\bar\epsilon)&0\leq x_i\leq \lambda_i\\
0&{\rm ow}
\end{cases}
\end{equation}
and it's depicted on Figure~(\ref{figOpExUt}).  It's safe to assume that the utility parameters $a_0,\,a_1$ are such that $r^u\geq 1$, and, therefore, we can dismiss the case of $r_i\geq r^u$ \jd{more on this}.  Then, the optimal policy, and optimal expected utility can be written as
\[r_i^*(x_i)=\max\{\lambda_i(p),x_i\},\quad \Ex_p\{\pi_i(r_i^*(x_i)(1-\epsilon_i))\}=a_0-a_1\max\{\lambda_i(p),x_i\}(1-S_i(p)\bar{\epsilon}).\]

\jd{comment of autoregulation on the agent's strategy.  Add the impossibility of distress. }

\subsection{Central Planner \jd{regulator?} Problem}
In this section we study the problem of a benevolent \jd{por supuesto!} central problem, whose main problem is to guarantee the stability of the financial network under capital shocks. The mechanism available for the Central Planner, is the minimum capital index required for each institution, i.e., this agent decides $x=(x_1,\ldots,x_N)$.  The central planner faces the problem of guaranteeing financial stability, as long as maximizing each institution's utility.  In this setting, we introduce ambiguity on the propagation parameters, i.e., the central planner has partial knowledge on the parameter $p$, that is modeled as a random variable with possible outcomes $\{p_1,\ldots,p_K\}$, with associated probabilities $\alpha_i=\Pro\{p=p_i\}$.  Denoting $\bar{p}=\Ex\{p\}$, we consider three possible objective functions, describing the goal of the central planner, based on the approach presented on \cite{Mac13alpha}
\begin{equation}\label{objcp}
f_{\theta,\gamma}(x)= \Ex_{\bar p}\Lset\sum_{i=1}^N \pi_i(r_i^*(x_i)(1-\epsilon_i))\Rset-\frac{\theta}{2}\var_{\bar p}\left(\sum_{i=1}^N\pi_i(r_i^*(x_i)(1-\epsilon_i))\right)-\frac{\gamma}{2}\var_\alpha\left(\sum_{i=1}^N\Ex_{p_i}\{\pi_i(r_i^*(x_i)(1-\epsilon_i))\}\right)
\end{equation}
This function offers a three different possibilities of analysis: first, the central planner is only concerned in maximizing the expected utility, under the expected propagation factor $\bar{p}$, secondly, the objective is to maximize the expected utility as well as minimizing the risk of the sum of utility functions, and lastly, the objective is to extend the previous case by adding a risk minimization on the ambiguity coming from the possibility of having different values of $p$.

\subsubsection{Risk-neutral Central Planner (RNCP) $(\theta=0,\gamma=0)$}
In this case, the propagation factor is fixed to $\bar p$, thus the risk-neutral central planner solves the following optimization problem
\begin{equation}\label{eq:rncp}
x^*=(x_1^*,\ldots,x_N^*)\in\argmax_{x_1,\ldots,x_N} f_{0,0}(x)=\Ex_{\bar p}\Lset\sum_{i=1}^N \pi_i(r_i^*(x_i)(1-\epsilon_i))\Rset = \sum_{i=1}^N \Ex_{\bar p} \pi_i(r_i^*(x_i)(1-\epsilon_i))
\end{equation}

The central planner can adopt two possible strategies, depending on the final goal \jd{more on this}: on one hand, impose individual capital index constraints, given by an individual policy $x_i$ for each institution. On the other hand, for information considerations, the proposed policy is a general rule, i.e., $x_i=x,\forall i$.

The solution to these two optimization problems are given by:
\begin{description}
\item[Individual policy] In this case, the problem of maximizing the function $f_{0,0}(x)$ defined in Equation~(\ref{eq:rncp}) is separable on each $x_i$, and the solution is given by
\begin{equation}\label{eq:solrncpi}
\max_{(x_1,\ldots,x_N} f_{0,0}(x)\iff x_i^*\in\argmax \Ex_{\bar{p}}\pi_i(r^*_i(x_i)(1-\epsilon_i))=[0,\lambda_i(\bar{p})],\,i=1,\ldots,N
\end{equation}

\item[Global policy] In this case, the central planner is only able to choose one value of $x$ for every institution of the financial network.  Therefore, the solution that maximizes the utility is given by
\begin{equation}\label{eq:solrncpu}
\max_{x} f_{0,0}(x)\iff x^*\in\argmax \sum_{i=1}^N \Ex_{\bar{p}}\pi_i(r^*_i(x)(1-\epsilon_i))=[0,\min_{i=1,\ldots,N}\{\lambda_i(\bar{p})\}]
\end{equation}
\end{description}
\jd{Note that this analysis always incorporates that the agents internalize the non-default condition, i.e., if the policy $x$ is too low, they natural move their optimal level to the one that avoid the default case}

\subsubsection{Risk-averse Central Planner (RACP) $(\theta>0,\gamma=0)$}
Given a parameter of risk aversion $\theta>0$, the central planner solves the following problem
\begin{equation}\label{eq:racp}
x^*\in\argmax_{x}  f_{\theta,0}(x)=\Ex_{\bar p}\left(\sum_{i=1}^N \pi_i(r^*_i(x_i)(1-\epsilon_i))\right) - \frac{\theta}{2}\var_{\bar p} \left(\sum_{i=1}^N \pi_i(r^*_i(x_i)(1-\epsilon_i))\right).
\end{equation}
In order to analyze this optimization problem, the risk-aversion term coming from the variance is written as 
\[\var_{\bar p}\left(\sum_{i=1}^N \pi_i(r^*_i(x_i)(1-\epsilon_i))\right)=\sum_{i=1}^N \var_{\bar p}(\pi_i(r^*_i(x_i)(1-\epsilon_i)))+2\sum_{j<i}\cov_{\bar p}(\pi_i(r^*_i(x_i)(1-\epsilon_i)),\pi_j(r^*_j(x_j)(1-\epsilon_j))).\]
Thus, the first computations needed are pairwise covariances.  Thus,
\begin{eqnarray*}
\cov_{\bar p}(\pi_i(r^*_i(x_i)(1-\epsilon_i)),\pi_j(r^*_j(x_j)(1-\epsilon_j)))&=&\Ex\Lset\left(a_0-a_1\max\{\lambda_i(\bar{p}),x_i\}(1-\epsilon_i)-a_0+a_1\max\{\lambda_i(\bar{p}),x_i\}(1-\bar{\epsilon_i})\right)\\
&&\quad\cdot\left(a_0-a_1\max\{\lambda_j(\bar{p}),x_j\}(1-\epsilon_j)-a_0+a_1\max\{\lambda_j(\bar{p}),x_j\}(1-\bar{\epsilon_j})\right)\Rset\\
&=&a_1^2\,S_i(\bar{p})\,S_j(\bar{p})\,\max\{\lambda_i(\bar{p}),x_i\}\,\max\{\lambda_j(\bar{p}),x_j\}\,\Ex\lset (\epsilon-\bar{\epsilon})^2\}\\
&=&a_1^2\,S_i(\bar{p})\,S_j(\bar{p})\,\max\{\lambda_i(\bar{p}),x_i\}\,\max\{\lambda_j(\bar{p}),x_j\}\,\frac{b^ 2}{12}
\end{eqnarray*}
Therefore, the objective function in Equation~(\ref{eq:racp}) is given by
\[f_{\theta,0}(x)=\sum_{i=1}^N a_0-a_1\max\{\lambda_i(\bar{p}),x_i\}(1-S_i(\bar{p})\bar{\epsilon})-\frac{\theta}{2}\frac{(a_1\,b)^2}{12}\sum_{i=1}^N\sum_{j=1}^N S_i(\bar{p})\,S_j(\bar{p})\,\max\{\lambda_i(\bar{p}),x_i\}\,\max\{\lambda_j(\bar{p}),x_j\}.\]
From this expression, it's easy to see that the the maximum of $f_{\theta,0}$ coincide with the maximum of $f_{0,0}$, as both terms are constant on the area $\{x:0\leq x_i\leq \lambda_i(\bar{p})\}$, and are decreasing outside this region.  Thus, the central planner solution for both problems, Individual and Global policy, are given by Equation~(\ref{eq:solrncpi}) and Equation~(\ref{eq:solrncpu}) respectively.


\subsubsection{Ambiguity-averse Central Planner (AACP) $(\theta>0,\gamma=0)$}
Consider the case where the Central Planner faces ambiguity with respect to the parameter $p$.  In this case, for $\theta>0$ and $\gamma>0$, the optimization problem is given by
\begin{equation}\label{eq:aacp}
x^*\in\argmax_{x}  f_{0,\gamma}(x)= f_{0,0}(x) - \frac{\gamma}{2}\var_{\alpha} \left(\sum_{i=1}^N \Ex_{\bf p}\{\pi_i(r^*_i(x_i)(1-\epsilon_i))\}\right).
\end{equation}
We follow the same strategy to compute the ambiguity term, i.e., by computing the individual covariances.  These terms are given by 
\begin{eqnarray*}
\cov_\alpha\left(\Ex_{\bf p}\pi_i(x_i),\Ex_{\bf p}\pi_j(x_j)\right)&=&a_1^2\sum_{k=1}^K \alpha_k \left(\max\{x_i,\lambda_i(p_k)\}(1-S_i(p_k)\bar{\epsilon}) - \max\{x_i,\lambda_i(\bar{p})\}(1-S_i(\bar{p})\bar{\epsilon}) \right)\\
&&\quad\quad\quad\quad\cdot\left(\max\{x_j,\lambda_j(p_k)\}(1-S_j(p_k)\bar{\epsilon}) - \max\{x_j,\lambda_j(\bar{p})\}(1-S_j(\bar{p})\bar{\epsilon}) \right)
\end{eqnarray*} 
The final form of the objective function will include a series of variance and covariance terms that decompose into piecewise linear/quadratic functions.  Thus, the central planner problem belongs to the family of nonlinear, non-concave problems, and it can be solved by using state-of-the-art global optimization solver to find the optimal value.  In the next section we explore numerical solutions to this problem for a series of financial networks.

\subsection{Examples}
\subsubsection{Toy example}
\subsubsection{\jd{Mid-size real example}}